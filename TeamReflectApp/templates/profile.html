{% extends "base.html" %}

{% block title %}{{ profile.user.username }} -- Profile{% endblock %}

{% block content %}
<body>
    <p>
        {% if profile.profile_image %}
            <img src="{{ profile.profile_image.url }}" alt="Profile Picture" style="max-width: 600px; max-height: 600px;">
        {% endif %}
            
        {% if can_edit %}
            <button onclick="editField('imageForm')">Edit</button>
        {% endif %}
    </p>
    
    <form id="imageForm" style="display:none;" method="POST" enctype="multipart/form-data" action="{% url 'edit_profile_field' username=profile.user.username %}">
        {% csrf_token %}
        <input type="hidden" name="field" value="image">
        <input type="file" name="image" accept="image/*">
        <button type="submit">Save</button>
        <button type="button" onclick="cancelEdit('imageForm')">Cancel</button>
    </form>

    <h1>{{ profile.user.username }}</h1>
    <h2>
        {{ profile.user.first_name }} {{ profile.user.last_name }}
        {% if can_edit%}
            <button onclick="editField('nameForm')">Edit</button>
        {% endif %}
    </h2>
    <form id="nameForm" style="display:none;" method="POST" action="{% url 'edit_profile_field' username=profile.user.username %}">
        {% csrf_token %}
        <input type="hidden" name="field" value="name">
        <input type="text" name="first_name" placeholder="First Name" value="{{ profile.user.first_name }}">
        <input type="text" name="last_name" placeholder="Last Name" value="{{ profile.user.last_name }}">
        <button type="submit">Save</button>
        <button type="button" onclick="cancelEdit('nameForm')">Cancel</button>
    </form>

    <p>
        <strong>Phone:</strong> {{ profile.phone_number }}
        {% if can_edit %}
            <button onclick="editField('phoneForm')">Edit</button>
        {% endif %}
    </p>
    <form id="phoneForm" style="display:none;" method="POST" action="{% url 'edit_profile_field' username=profile.user.username %}">
        {% csrf_token %}
        <input type="hidden" name="field" value="phone_number">
        <input type="text" name="phone_number" value="{{ profile.phone_number }}">
        <button type="submit">Save</button>
        <button type="button" onclick="cancelEdit('phoneForm')">Cancel</button>
    </form>

    <p>
        <strong>Description:</strong> {{ profile.description }}
        {% if can_edit %}
            <button onclick="editField('descriptionForm')">Edit</button>
        {% endif %}
    </p>
    <form id="descriptionForm" style="display:none;" method="POST" action="{% url 'edit_profile_field' username=profile.user.username %}">
        {% csrf_token %}
        <input type="hidden" name="field" value="description">
        <textarea name="description">{{ profile.description }}</textarea>
        <button type="submit">Save</button>
        <button type="button" onclick="cancelEdit('descriptionForm')">Cancel</button>
    </form>

    <p>
        <strong>Rating:</strong> {{ profile.rating }}
    </p>

    <form id="ratingForm" style="display:inline;" method="POST" action="{% url 'edit_profile_field' username=profile.user.username %}">
        {% csrf_token %}
        <input type="hidden" name="field" value="rating">
        <input type="hidden" name="rating" value= 1>
        <button type="submit">Like</button>
    </form>
    <form id="ratingForm" style="display:inline;" method="POST" action="{% url 'edit_profile_field' username=profile.user.username %}">
        {% csrf_token %}
        <input type="hidden" name="field" value="rating">
        <input type="hidden" name="rating" value= -1>
        <button type="submit">Dislike</button>
    </form>

    <script>
        function editField(formId) {
            document.getElementById(formId).style.display = 'block';
        }

        function cancelEdit(formId) {
            document.getElementById(formId).style.display = 'none';
        }
    </script>
</body>
{% endblock %}